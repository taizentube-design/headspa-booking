<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>東京のヘッドスパ一覧｜ヘッドスパ予約・紹介</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "Hiragino Sans", "Hiragino Kaku Gothic ProN", sans-serif; background: #f8f7f4; color: #333; line-height: 1.6; }
    .header { background: #2d2d2d; color: #fff; padding: 1rem 1.5rem; }
    .header a { color: #fff; text-decoration: none; font-size: 0.9rem; opacity: 0.9; }
    .header h1 { margin: 0.25rem 0 0; font-size: 1.25rem; font-weight: 600; }
    .header .count { font-size: 0.85rem; opacity: 0.9; margin-top: 0.25rem; }
    .main { max-width: 900px; margin: 0 auto; padding: 2rem 1.5rem; }
    .area-section h2 { font-size: 1rem; margin-bottom: 1rem; color: #555; font-weight: 600; }
    .area-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.75rem; }
    .area-btn { display: block; padding: 1rem; background: #fff; border: 1px solid #e0ddd8; border-radius: 8px; text-align: center; text-decoration: none; color: #333; font-weight: 500; transition: border-color .2s, box-shadow .2s; }
    .area-btn:hover { border-color: #c9c5be; box-shadow: 0 2px 8px rgba(0,0,0,.06); }
    .area-btn .count { display: block; font-size: 0.8rem; color: #666; font-weight: 400; margin-top: 0.25rem; }
    .store-list { display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; }
    .store-card { background: #fff; border: 1px solid #e0ddd8; border-radius: 8px; padding: 1.25rem; text-decoration: none; color: inherit; display: block; transition: box-shadow .2s; }
    .store-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,.08); }
    .store-card h3 { margin: 0 0 0.5rem; font-size: 1.1rem; font-weight: 600; }
    .store-card .meta { font-size: 0.9rem; color: #666; margin-bottom: 0.75rem; }
    .store-card .store-thumb { width: 100%; height: 140px; object-fit: cover; border-radius: 6px 6px 0 0; margin: -1.25rem -1.25rem 0.75rem -1.25rem; display: block; }
    .store-card .actions { display: flex; gap: 1rem; flex-wrap: wrap; }
    .store-card .btn { font-size: 0.85rem; color: #0066cc; }
    .district-title { font-size: 1.1rem; font-weight: 600; color: #333; margin: 0 0 1rem; }
    .back-link { display: inline-block; margin-bottom: 1rem; font-size: 0.9rem; color: #0066cc; text-decoration: none; }
    .back-link:hover { text-decoration: underline; }
    .footer { max-width: 900px; margin: 0 auto; padding: 1.5rem; font-size: 0.8rem; color: #888; border-top: 1px solid #e8e6e2; }
    .load-err { padding: 2rem; text-align: center; color: #666; }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html">← トップへ</a>
    <h1 id="header-title">東京のヘッドスパ一覧</h1>
    <p class="count" id="count">—</p>
  </header>

  <main class="main">
    <div id="content">
      <p class="load-err">読み込み中…</p>
    </div>
  </main>

  <footer class="footer">
    ヘッドスパ予約・紹介（MVP）｜東京のヘッドスパ一覧<br>
    当サイトでは提携・アフィリエイトリンクを利用している場合があります。該当箇所に「PR」表記をしています。
  </footer>
  <script>
    (function () {
      var contentEl = document.getElementById('content');
      var headerTitleEl = document.getElementById('header-title');
      var countEl = document.getElementById('count');
      var districtOrder = ['渋谷', '新宿', '銀座', '表参道', '恵比寿', '池袋', '品川', 'その他'];

      function getDistrictFromUrl() {
        var params = new URLSearchParams(document.location.search);
        return params.get('district') || '';
      }

      function escapeHtml(s) {
        if (!s) return '';
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }
      function escapeAttr(s) {
        if (!s) return '';
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
      }

      function renderStoreCard(s) {
        var meta = (s.address ? s.address.replace(/^東京都/, '') : '') + (s.hours && s.hours !== '要確認' ? '・営業時間 ' + s.hours : '');
        var thumb = s.image_url ? '<img class="store-thumb" src="' + escapeAttr(s.image_url) + '" alt="" loading="lazy">' : '';
        return '<a class="store-card" href="store.html?id=' + s.id + '">' +
          thumb +
          '<h3>' + escapeHtml(s.name) + '</h3>' +
          '<p class="meta">' + escapeHtml(meta || '—') + '</p>' +
          '<div class="actions"><span class="btn">詳細を見る →</span><span class="btn">予約・電話</span></div>' +
          '</a>';
      }

      fetch('../data/stores.json')
        .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error('fetch')); })
        .then(function (stores) {
          var tokyo = stores.filter(function (s) { return s.area === '東京'; });
          var byDistrict = {};
          tokyo.forEach(function (s) {
            var d = s.district || 'その他';
            if (!byDistrict[d]) byDistrict[d] = [];
            byDistrict[d].push(s);
          });
          var order = [];
          districtOrder.forEach(function (d) { if (byDistrict[d]) order.push(d); });
          Object.keys(byDistrict).forEach(function (d) {
            if (order.indexOf(d) === -1) order.push(d);
          });

          var district = getDistrictFromUrl();

          if (district && byDistrict[district]) {
            var list = byDistrict[district];
            headerTitleEl.textContent = district + 'のヘッドスパ';
            countEl.textContent = list.length + '件';
            document.title = district + 'のヘッドスパ｜ヘッドスパ予約・紹介';
            contentEl.innerHTML =
              '<a class="back-link" href="tokyo.html">← エリア選択に戻る</a>' +
              '<h2 class="district-title">' + escapeHtml(district) + 'のヘッドスパ一覧</h2>' +
              '<div class="store-list">' + list.map(renderStoreCard).join('') + '</div>';
          } else {
            headerTitleEl.textContent = '東京のヘッドスパ一覧';
            countEl.textContent = tokyo.length + '件';
            contentEl.innerHTML =
              '<section class="area-section">' +
                '<h2>エリアを選ぶ</h2>' +
                '<div class="area-grid">' +
                  order.map(function (d) {
                    var n = byDistrict[d].length;
                    return '<a class="area-btn" href="tokyo.html?district=' + encodeURIComponent(d) + '">' +
                      escapeHtml(d) +
                      '<span class="count">' + n + '件</span>' +
                    '</a>';
                  }).join('') +
                '</div>' +
              '</section>';
          }
        })
        .catch(function () {
          countEl.textContent = '0件';
          contentEl.innerHTML = '<p class="load-err">データを取得できませんでした。GitHub Pages で開いている場合は、しばらく待ってから再読み込みしてください。</p>';
        });
    })();
  </script>
</body>
</html>
